<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>homepage</title>
</head>

<body>
    <h1>Homepage</h1>
    <input type="button" value="Create an Expence" onclick="createCKExpence()">
    <br><br>
    <div>
        Join a Group now!
        <form action= "group.html">
            <input id="bar" onkeyup="loadUserGroups()" type="text"
            name="search">
            <input type = "submit" value = "-> GROUP PAGE">
        </form>
        
        <!-- ordered list -->
        <div id = "results"></div>
        <br>or
        <input type="button" name="button" id="createButton" value="Create a New Group" onclick="createGroup()">
        <br><br><br>
        <div id="userGroups"></div>
    </div>

    <script>
        var searchresult = null;
        var timesIn = 0;
        var inAndOut = 0
        function loadUserGroups() {
            var counter = 0;
            console.log("sono qui "+ inAndOut);
            inAndOut+=1;
            let input = document.getElementById("bar").value;
            document.getElementById("results").innerHTML = "";//delete previously shown groups
            if(searchresult==null){
                console.log("lista vuota");
                var url = "http://localhost:8080/api/v1/groups";
                var xmlhttp = new XMLHttpRequest();
                const result = fetch(url, {
                method: "GET"
            }).then(response => response.json())

                .then(groupList => {
                    searchresult = groupList;
                    var listtop = '<ul>';
                    //main table content we fill from data from the rest call
                    var main = "";
                    for (i = 0; i < searchresult.length; i++) {
                        let upNameGroup = searchresult[i].groupName.toUpperCase();
                        let upInput = input.toUpperCase()
                        if(upNameGroup.includes(upInput)){
                            timesIn += 1;
                            let timesInPls = timesIn+1;
                            let newId = "id"+timesInPls;
                            console.log("first time");
                            main += "<li id=\""+newId+"\" class=\"listItem\">";
/*                          main += "<a href=\"group.html?searchbar="+groupList[i].groupName+"\">"; */
                            main += searchresult[i].groupName + "</li>";
                            counter+=1;
                        }      
                    }
                    var listbottom = "</ul>";
                    var list = listtop + main + listbottom;
                    document.getElementById("results").innerHTML = list;
                });
            }
            else{
                console.log("lista non vuota");
                var listtop = '<ul>';
                    //main table content we fill from data from the rest call
                    var main = "";
                    for (i = 0; i < searchresult.length; i++) {
                        let upNameGroup = searchresult[i].groupName.toUpperCase();
                        let upInput = input.toUpperCase()
                        if(upNameGroup.includes(upInput)){
                        timesIn += 1;
                            let timesInPls = timesIn+1;
                            let newId = "id"+timesInPls;
                            console.log("first time");
                            main += "<li id=\""+newId+"\" class=\"listItem\">";
/*                          main += "<a href=\"group.html?searchbar="+groupList[i].groupName+"\">"; */
                            main += searchresult[i].groupName +"</li>";
                            counter+=1;
                        }
                    }
                    var listbottom = "</ul>";
                    var list = listtop + main + listbottom;
                    document.getElementById("results").innerHTML = list;
            }

            let previousTimesIn = timesIn - counter + 1;
            for(j=0;j<counter;j++){
                    let timesInPls = previousTimesIn+1;
                    let newId = "id"+timesInPls;
                    var get = document.getElementById(newId);
                    get.addEventListener("click", clickEvent, false);
                    previousTimesIn+=1;
                }
        }

        function clickEvent(ev){
<!--            console.log("hey there");-->
            console.log(ev.target.innerHTML);
            document.getElementById("bar").value = ev.target.innerHTML;
        }
    </script>

    
</body>
</html>